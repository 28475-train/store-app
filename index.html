<!DOCTYPE html>
<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é¡§å®¢ç”¨åº—èˆ—ã‚¢ãƒ—ãƒª</title>
<style>
body{font-family:'Helvetica',sans-serif;margin:0;background:#e6f2ff;color:#333;}
.container{max-width:500px;margin:auto;padding:15px;}
.screen{display:none;}
.active{display:block;}
input,button{width:100%;padding:12px;margin-top:8px;font-size:16px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;}
button{background:#0099ff;color:white;font-weight:bold;border:none;cursor:pointer;transition:0.2s;}
button:hover{background:#007acc;}
h2{text-align:center;margin-top:0;}
nav{position:fixed;bottom:0;left:0;width:100%;background:#fff;display:flex;border-top:1px solid #ccc;}
nav button{flex:1;border:none;border-radius:0;margin:0;padding:15px;background:#e6f2ff;}
nav button.active{background:#0099ff;color:white;font-weight:bold;}
.box{background:white;padding:15px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);margin-top:15px;text-align:center;}
.logo{display:block;margin:auto;width:120px;}
#barcode svg{width:100%;height:80px;}
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<div class="container">
<img src="https://dummyimage.com/120x60/0099ff/ffffff&text=LOGO" class="logo" alt="åº—èˆ—ãƒ­ã‚´">

<!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div id="login" class="screen active">
<h2>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
<div class="box">
<input id="phone_login" placeholder="é›»è©±ç•ªå·">
<input id="pass_login" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" type="password">
<button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
<hr>
<h3>ğŸ†• æ–°è¦ç™»éŒ²</h3>
<input id="name_reg" placeholder="åå‰">
<input id="phone_reg" placeholder="é›»è©±ç•ªå·">
<input id="pass_reg" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" type="password">
<button onclick="register()">ç™»éŒ²</button>
</div>
</div>

<!-- ãƒ›ãƒ¼ãƒ  -->
<div id="home" class="screen">
<h2>ğŸ  ãƒ›ãƒ¼ãƒ </h2>
<div class="box">
<p id="home_name"></p>
<p id="home_point"></p>
<button onclick="go('barcode')">ğŸ“² ãƒãƒ¼ã‚³ãƒ¼ãƒ‰è¡¨ç¤º</button>
<button onclick="go('reserve')">ğŸ“… äºˆç´„ç™»éŒ²</button>
<button onclick="logout()">ğŸšªãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
</div>
</div>

<!-- ãƒãƒ¼ã‚³ãƒ¼ãƒ‰è¡¨ç¤º -->
<div id="barcode" class="screen">
<h2>ğŸ“² ä¼šå“¡ãƒãƒ¼ã‚³ãƒ¼ãƒ‰</h2>
<div class="box">
<p id="user_name"></p>
<p id="user_point"></p>
<div id="barcode"></div>
<p>â€»ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’åº—å´ç«¯æœ«ã§èª­ã¿å–ã‚‹ã¨ãƒã‚¤ãƒ³ãƒˆãŒè‡ªå‹•åŠ ç®—ã•ã‚Œã¾ã™ã€‚</p>
<button onclick="go('home')">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
</div>
</div>

<!-- äºˆç´„ -->
<div id="reserve" class="screen">
<h2>ğŸ“… äºˆç´„</h2>
<div class="box">
<input id="rv_date" type="datetime-local">
<button onclick="reserve()">äºˆç´„ç™»éŒ²</button>
</div>
</div>

<p id="msg" style="text-align:center;margin-top:10px;font-weight:bold;"></p>
</div>

<nav>
<button onclick="go('home')" id="tab_home">ğŸ </button>
<button onclick="go('login')" id="tab_login" class="active">ğŸ”‘</button>
<button onclick="go('reserve')" id="tab_res">ğŸ“…</button>
<button onclick="go('barcode')" id="tab_barcode">ğŸ“²</button>
</nav>

<script>
const API="https://script.google.com/macros/s/AKfycby3s4ajbk3PTfrrhP-klJ3ERAdSiIIiXOXjFoOr4YO8DzP0Veq1mghE4BgGfA1lwlT4/exec";
let uid="",name="",point=0;

window.onload=function(){
  uid = localStorage.getItem("uid");
  name = localStorage.getItem("name");
  point = localStorage.getItem("point");
  if(uid){ showBarcode(); go('home'); }
};

function go(id){
 document.querySelectorAll('.screen').forEach(v=>v.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
 document.getElementById("tab_"+id)?.classList.add('active');
}

async function register(){
 let data={name:val("name_reg"),phone:val("phone_reg"),pass:val("pass_reg")};
 let r=await fetch(API,{method:"POST",body:JSON.stringify(data)}).then(r=>r.json());
 msg("ç™»éŒ²å®Œäº†ğŸ‰ ID:"+r.userId);
}

async function login(){
 let data={phone:val("phone_login"),pass:val("pass_login"),login:true};
 let r=await fetch(API,{method:"POST",body:JSON.stringify(data)}).then(r=>r.json());
 if(r.status==="LOGIN_OK"){
  uid=r.userId; name=r.name; point=r.point;
  localStorage.setItem("uid",uid); localStorage.setItem("name",name); localStorage.setItem("point",point);
  showBarcode(); go('home');
 }else msg("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—");
}

function showBarcode(){
 if(!uid){ id("msg").innerText="ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„"; return;}
 id("user_name").innerText="ä¼šå“¡ï¼š"+name;
 id("user_point").innerText="ä¿æœ‰ãƒã‚¤ãƒ³ãƒˆï¼š"+point;
 JsBarcode("#barcode", uid, {format:"CODE128",width:2,height:50,displayValue:true});
}

function reserve(){ msg("äºˆç´„ç™»éŒ²å®Œäº†ğŸ“…ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜æ¸ˆã¿ï¼‰"); }
function logout(){ localStorage.clear(); location.reload(); }

const id=i=>document.getElementById(i);
const val=i=>id(i).value;
const msg=t=>id("msg").innerText=t;
</script>
</body>
</html>

