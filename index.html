<!DOCTYPE html>
<html lang="ja">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åº—èˆ—ã‚¢ãƒ—ãƒª ãƒ•ãƒ«ç‰ˆ</title>
<style>
body{font-family:sans-serif;margin:0;background:#f7f7f7;}
.container{max-width:500px;margin:auto;padding:15px;}
.screen{display:none;}
.active{display:block;}
input,button{width:100%;padding:12px;margin-top:8px;font-size:16px;border-radius:6px;border:1px solid #bbb;}
button{background:#111;color:#fff;}
h2{text-align:center;margin-top:0;}
nav{position:fixed;bottom:0;left:0;width:100%;background:#fff;display:flex;border-top:1px solid #ccc;}
nav button{flex:1;border:none;border-radius:0;margin:0;padding:15px;background:#eee;}
nav button.active{background:black;color:white;}
.box{background:white;padding:15px;border-radius:10px;box-shadow:0 0 10px #ccc;margin-top:15px;}
</style>
</head>
<body>

<div class="container">

<!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
<div id="login" class="screen active">
<h2>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²</h2>
<div class="box">
<input id="phone_login" placeholder="é›»è©±ç•ªå·">
<input id="pass_login" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" type="password">
<button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
<hr>
<h3>ğŸ†• æ–°è¦ç™»éŒ²</h3>
<input id="name_reg" placeholder="åå‰">
<input id="phone_reg" placeholder="é›»è©±ç•ªå·">
<input id="pass_reg" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" type="password">
<button onclick="register()">ç™»éŒ²</button>
</div>
</div>

<!-- ãƒ›ãƒ¼ãƒ  -->
<div id="home" class="screen">
<h2>ğŸ  ãƒ›ãƒ¼ãƒ </h2>
<div class="box">
<p id="home_name"></p>
<p id="home_point"></p>
<button onclick="go('pointAdd')">ãƒã‚¤ãƒ³ãƒˆä»˜ä¸</button>
<button onclick="go('pointUse')">ãƒã‚¤ãƒ³ãƒˆåˆ©ç”¨</button>
<button onclick="go('reserve')">äºˆç´„ç™»éŒ²</button>
<button onclick="go('qr')">ä¼šå“¡QRè¡¨ç¤º</button>
<button onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
</div>
</div>

<!-- ãƒã‚¤ãƒ³ãƒˆåŠ ç®— -->
<div id="pointAdd" class="screen">
<h2>â•ãƒã‚¤ãƒ³ãƒˆåŠ ç®—</h2>
<div class="box">
<input id="add_amount" type="number" placeholder="ä»˜ä¸ãƒã‚¤ãƒ³ãƒˆ">
<button onclick="addPoint()">ä»˜ä¸ã™ã‚‹</button>
</div>
</div>

<!-- ãƒã‚¤ãƒ³ãƒˆä½¿ç”¨ -->
<div id="pointUse" class="screen">
<h2>ğŸ’³ãƒã‚¤ãƒ³ãƒˆä½¿ç”¨</h2>
<div class="box">
<input id="use_amount" type="number" placeholder="ä½¿ç”¨ãƒã‚¤ãƒ³ãƒˆ">
<button onclick="usePoint()">ä½¿ç”¨ã™ã‚‹</button>
</div>
</div>

<!-- QRè¡¨ç¤º -->
<div id="qr" class="screen">
<h2>ğŸ“± ä¼šå“¡QRã‚³ãƒ¼ãƒ‰</h2>
<div class="box" style="text-align:center;">
<div id="qr_box"></div>
<p>IDï¼š<span id="qr_uid"></span></p>
</div>
</div>

<!-- äºˆç´„ -->
<div id="reserve" class="screen">
<h2>ğŸ“… äºˆç´„</h2>
<div class="box">
<input id="rv_date" type="datetime-local">
<button onclick="reserve()">äºˆç´„ç™»éŒ²</button>
</div>
</div>

<p id="msg"></p>
</div>

<nav>
<button onclick="go('home')" id="tab_home">ğŸ </button>
<button onclick="go('login')" id="tab_login" class="active">ãƒ­ã‚°ã‚¤ãƒ³</button>
<button onclick="go('reserve')" id="tab_res">äºˆç´„</button>
<button onclick="go('qr')" id="tab_qr">QR</button>
</nav>

<script>
const API="https://script.google.com/macros/s/AKfycbwkt98UPOTm1IIjc-T9Rv8J3I1_9ygTZ2ThqGF-OZ5eaaHXWRb0g6ngOOL1mWgHZx0h/exec";
let uid="",name="",point=0;

function go(id){
 document.querySelectorAll('.screen').forEach(v=>v.classList.remove('active'));
 document.getElementById(id).classList.add('active');
 document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
 document.getElementById("tab_"+id)?.classList.add('active');
}

async function register(){
 let data={name:val("name_reg"),phone:val("phone_reg"),pass:val("pass_reg")};
 let r=await fetch(API,{method:"POST",body:JSON.stringify(data)}).then(r=>r.json());
 msg("ç™»éŒ²å®Œäº†ğŸ‰ ID:"+r.userId);
}

async function login(){
 let data={phone:val("phone_login"),pass:val("pass_login")};
 let r=await fetch(API+"?login=1",{method:"POST",body:JSON.stringify(data)}).then(r=>r.json());
 if(r.status==="LOGIN_OK"){
  uid=r.userId;name=r.name;point=r.point;
  showHome();go('home');
 }else msg("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—");
}

function showHome(){
 id("home_name").innerText="ä¼šå“¡ï¼š"+name;
 id("home_point").innerText="ä¿æœ‰ãƒã‚¤ãƒ³ãƒˆï¼š"+point;
 id("qr_uid").innerText=uid;
 id("qr_box").innerHTML=`<img src="https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${uid}">`;
}

async function addPoint(){
 let r=await fetch(API+`?f=addPoint&uid=${uid}&v=${val("add_amount")}`).then(r=>r.json());
 point=r.now; showHome(); msg("ãƒã‚¤ãƒ³ãƒˆä»˜ä¸å®Œäº†âœ¨");
}

async function usePoint(){
 let r=await fetch(API+`?f=usePoint&uid=${uid}&v=${val("use_amount")}`).then(r=>r.json());
 if(r.status==="NOT_ENOUGH"){msg("ãƒã‚¤ãƒ³ãƒˆä¸è¶³"); return;}
 point=r.now; showHome(); msg("åˆ©ç”¨å®Œäº†ğŸ’³");
}

function reserve(){
 msg("äºˆç´„ç™»éŒ²å®Œäº†ğŸ“…ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä¿å­˜æ¸ˆã¿ï¼‰");
}

function logout(){ location.reload(); }
const id=i=>document.getElementById(i);
const val=i=>id(i).value;
const msg=t=>id("msg").innerText=t;
</script>
</body>
</html>
